# DB 설계서 (Oracle) - 회원가입 + 게시판

## 1. 목표 / 범위
- 회원가입/로그인(세션 기반 인증) + 게시글 CRUD를 위한 최소 DB 구조(MVP)
- 확장(댓글/첨부/카테고리)은 2차 범위로 분리

---

## 2. 설계 원칙
- PK는 `NUMBER(19)`(bigint급) 사용
- 필수 컬럼은 `NOT NULL`
- 소프트 삭제: `DEL_YN(CHAR(1))` + `DEL_DTTM(DATE)` 사용
- 감사 컬럼: `CRT_DTTM`, `UPD_DTTM` 필수
- 이메일은 유일(Unique) 제약
- FK는 기본적으로 `ON DELETE` 옵션 없이(안전) 운영

---

## 3. 테이블 목록

| 테이블 | 설명 |
|--------|------|
| TB_USER | 사용자(회원) |
| TB_POST | 게시글 |

---

## 4. 테이블 상세

## 4.1 TB_USER (회원)

### 컬럼
| 컬럼명 | 타입 | NULL | 기본값 | 설명 |
|-------|------|------|--------|------|
| USER_ID | NUMBER(19) | N | IDENTITY | 사용자 PK |
| EMAIL | VARCHAR2(255) | N | - | 로그인 ID(이메일), 유일 |
| PWD_HASH | VARCHAR2(100) | N | - | BCrypt 해시 저장 |
| NICKNAME | VARCHAR2(50) | Y | - | 표시명(선택) |
| STATUS | VARCHAR2(20) | N | 'ACTIVE' | ACTIVE/BLOCKED 등 |
| CRT_DTTM | DATE | N | SYSDATE | 생성일시 |
| UPD_DTTM | DATE | N | SYSDATE | 수정일시 |
| DEL_YN | CHAR(1) | N | 'N' | 삭제여부(Y/N) |
| DEL_DTTM | DATE | Y | - | 삭제일시 |

### 제약/인덱스
- PK: `PK_TB_USER(USER_ID)`
- UK: `UK_TB_USER_EMAIL(EMAIL)`
- CHECK: `DEL_YN IN ('Y','N')`
- (선택) 닉네임 유일이 필요하면 `UK_TB_USER_NICKNAME(NICKNAME)` 추가

---

## 4.2 TB_POST (게시글)

### 컬럼
| 컬럼명 | 타입 | NULL | 기본값 | 설명 |
|-------|------|------|--------|------|
| POST_ID | NUMBER(19) | N | IDENTITY | 게시글 PK |
| USER_ID | NUMBER(19) | N | - | 작성자(FK) |
| TITLE | VARCHAR2(200) | N | - | 제목 |
| CONTENT | CLOB | N | - | 본문 |
| VIEW_CNT | NUMBER(10) | N | 0 | 조회수 |
| CRT_DTTM | DATE | N | SYSDATE | 생성일시 |
| UPD_DTTM | DATE | N | SYSDATE | 수정일시 |
| DEL_YN | CHAR(1) | N | 'N' | 삭제여부(Y/N) |
| DEL_DTTM | DATE | Y | - | 삭제일시 |

### 제약/인덱스
- PK: `PK_TB_POST(POST_ID)`
- FK: `FK_TB_POST_USER(USER_ID) → TB_USER(USER_ID)`
- CHECK: `DEL_YN IN ('Y','N')`
- 인덱스(목록 성능 핵심)
  - `IX_TB_POST_LIST(DEL_YN, POST_ID DESC)` 또는 `IX_TB_POST_LIST(DEL_YN, CRT_DTTM DESC)`
  - `IX_TB_POST_USER(USER_ID)`
- 조회수 업데이트가 잦으면 `VIEW_CNT`는 기본값만 두고 별도 튜닝은 추후

---

## 5. 관계(ERD 텍스트)
- TB_USER (1) —— (N) TB_POST
  - 한 명의 사용자는 여러 게시글을 작성할 수 있다.
  - 게시글은 반드시 한 명의 작성자를 가진다.

---

## 6. 주요 쿼리 기준(성능 고려)
### 6.1 게시글 목록(페이징, 소프트삭제 제외)
- 조건: `DEL_YN='N'`
- 정렬: 최신순(POST_ID DESC 또는 CRT_DTTM DESC)
- 페이징: `OFFSET / FETCH`(12c+) 또는 ROWNUM 방식(구버전)

### 6.2 마이페이지(내가 쓴 글)
- 조건: `USER_ID = :userId AND DEL_YN='N'`
- 인덱스: `IX_TB_POST_USER` 도움

---

## 7. DDL (Oracle 12c+ / IDENTITY 사용)

> 운영 표준에 따라 테이블명/컬럼명 대문자 사용

```sql
-- 1) TB_USER
CREATE TABLE TB_USER (
  USER_ID    NUMBER(19) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  EMAIL      VARCHAR2(255) NOT NULL,
  PWD_HASH   VARCHAR2(100) NOT NULL,
  NICKNAME   VARCHAR2(50),
  STATUS     VARCHAR2(20) DEFAULT 'ACTIVE' NOT NULL,
  CRT_DTTM   DATE DEFAULT SYSDATE NOT NULL,
  UPD_DTTM   DATE DEFAULT SYSDATE NOT NULL,
  DEL_YN     CHAR(1) DEFAULT 'N' NOT NULL,
  DEL_DTTM   DATE,
  CONSTRAINT PK_TB_USER PRIMARY KEY (USER_ID),
  CONSTRAINT UK_TB_USER_EMAIL UNIQUE (EMAIL),
  CONSTRAINT CK_TB_USER_DEL_YN CHECK (DEL_YN IN ('Y','N'))
);

-- 2) TB_POST
CREATE TABLE TB_POST (
  POST_ID    NUMBER(19) GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  USER_ID    NUMBER(19) NOT NULL,
  TITLE      VARCHAR2(200) NOT NULL,
  CONTENT    CLOB NOT NULL,
  VIEW_CNT   NUMBER(10) DEFAULT 0 NOT NULL,
  CRT_DTTM   DATE DEFAULT SYSDATE NOT NULL,
  UPD_DTTM   DATE DEFAULT SYSDATE NOT NULL,
  DEL_YN     CHAR(1) DEFAULT 'N' NOT NULL,
  DEL_DTTM   DATE,
  CONSTRAINT PK_TB_POST PRIMARY KEY (POST_ID),
  CONSTRAINT FK_TB_POST_USER FOREIGN KEY (USER_ID) REFERENCES TB_USER(USER_ID),
  CONSTRAINT CK_TB_POST_DEL_YN CHECK (DEL_YN IN ('Y','N'))
);

-- 3) Indexes
-- 목록 조회 최적화(최신순)
CREATE INDEX IX_TB_POST_LIST ON TB_POST (DEL_YN, POST_ID DESC);
-- 작성자 기준 조회(마이페이지 등)
CREATE INDEX IX_TB_POST_USER ON TB_POST (USER_ID);

-- (선택) 제목 검색을 자주 할 거면 추후 CTX 인덱스(Oracle Text) 고려

## 2-1. 네이밍 컨벤션 (Naming Convention)

본 프로젝트의 DB 객체는 아래 규칙을 따른다.  
객체 유형을 이름만 보고도 구분 가능하도록 접두어(prefix)를 사용한다.

### 1) 테이블 (Table)
- 형식: `TB_도메인명`
- 예시:
  - `TB_USER`
  - `TB_POST`

### 2) 기본키 (Primary Key)
- 형식: `PK_테이블명`
- 예시:
  - `PK_TB_USER`
  - `PK_TB_POST`

### 3) 외래키 (Foreign Key)
- 형식: `FK_자식테이블명_부모테이블명`
- 예시:
  - `FK_TB_POST_TB_USER`

### 4) 유니크 키 (Unique)
- 형식: `UK_테이블명_컬럼명`
- 예시:
  - `UK_TB_USER_EMAIL`

### 5) 인덱스 (Index)
- 형식: `IX_테이블명_용도`
- 예시:
  - `IX_TB_POST_LIST`
  - `IX_TB_POST_USER`

### 6) 체크 제약 (Check)
- 형식: `CK_테이블명_컬럼명`
- 예시:
  - `CK_TB_POST_DEL_YN`

### 7) 시퀀스 (Sequence) (12c 미만 사용 시)
- 형식: `SEQ_테이블명`
- 예시:
  - `SEQ_TB_USER`
  - `SEQ_TB_POST`

### 8) 트리거 (Trigger) (필요 시)
- 형식: `TRG_테이블명_동작`
- 예시:
  - `TRG_TB_POST_UPD_DTTM`
